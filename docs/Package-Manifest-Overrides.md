# Package Manifest Overrides

This document describes how to use the package manifest overrides feature to customize the YAML manifests generated by Komac or WinGetCreate.

## Overview

Package manifest overrides allow you to:
- **Add** new fields to manifests
- **Override** existing field values
- **Drop** unwanted fields
- Use **placeholders** that get substituted with dynamic values
- Apply different overrides to different manifest types (installer, locale, etc.)

## Override File Format

Override files use YAML format with three main sections:

```yaml
Add:
  # Fields to add if they don't exist
  Copyright: "Copyright (c) {{CURRENT_YEAR}}"
  
Override:
  # Fields to override regardless of existing value
  Publisher: "{{PACKAGE_NAME}} Corporation"
  Tags:
    - infrastructure
    - containers
    
Drop:
  # Fields to remove
  - License
  - ReleaseDate
```

## File Naming and Location

Override files should be placed in the `scripts/Packages/` directory with the naming pattern:
- `{PackageName}.{ManifestType}.overrides.yaml`

Examples:
- `GitHub.GitHubDesktop.Beta.locale.en-US.overrides.yaml` - for locale files
- `GitHub.GitHubDesktop.Beta.installer.overrides.yaml` - for installer files
- `Microsoft.VisualStudioCode.version.overrides.yaml` - for version files

## Available Placeholders

The following placeholders are available for substitution:

- `{{PACKAGE_NAME}}` - The package identifier
- `{{VERSION}}` - The package version being updated
- `{{RELEASE_NOTES}}` - Release notes from the package update
- `{{CURRENT_DATE}}` - Current date in YYYY-MM-DD format
- `{{CURRENT_YEAR}}` - Current year

## Examples

### Locale Override Example

```yaml
# File: scripts/Packages/MyApp.MyPackage.locale.en-US.overrides.yaml
Override:
  Tags:
    - productivity
    - business
  ReleaseNotes: "{{RELEASE_NOTES}}"
  
Add:
  ReleaseNotesUrl: "https://github.com/myorg/myapp/releases/tag/{{VERSION}}"
  Copyright: "Copyright (c) {{CURRENT_YEAR}} MyOrg"
```

### Installer Override Example

```yaml
# File: scripts/Packages/MyApp.MyPackage.installer.overrides.yaml
Override:
  Scope: machine
  InstallModes:
    - interactive
    - silent
    - silentWithProgress
    
Add:
  Dependencies:
    WindowsFeatures:
      - IIS-WebServerRole
      
Drop:
  - Platform
  - MinimumOSVersion
```

## Integration

The override system is automatically applied when using the `Update-WingetPackage` function. No additional parameters are required - the system will automatically:

1. Generate manifests using Komac or WinGetCreate
2. Look for override files matching the package name and manifest types
3. Apply any found overrides with placeholder substitution
4. Continue with the normal submission process

## Testing

You can test override files manually using the `Apply-ManifestOverrides` function:

```powershell
Import-Module ./modules/WingetMaintainerModule
$placeholders = @{
    'PACKAGE_NAME' = 'MyApp.MyPackage'
    'VERSION' = '1.0.0'
    'RELEASE_NOTES' = 'Initial release'
    'CURRENT_YEAR' = '2024'
}
Apply-ManifestOverrides -ManifestPath './manifest.yaml' -OverridePath './overrides.yaml' -PlaceholderValues $placeholders
```